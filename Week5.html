<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 5: SEM (Path models)</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr Nemanja Vaci" />
    <meta name="date" content="2024-03-08" />
    <script src="Week5_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Lecture 5: SEM (Path models)
]
.author[
### Dr Nemanja Vaci
]
.institute[
### University of Sheffield
]
.date[
### 2024-03-08
]

---






## Press record

---

## Corrections from the previous lecture


---

## Intended learning outcomes

Motivate utilisation of path and CFA models; Argue how they connect to other models that we covered at the course. &lt;br/&gt;&lt;br/&gt;

Calculate number of free parameters and degrees of freedom of the proposed model. &lt;br/&gt;&lt;br/&gt;

Build a model in R statistical environment, estimate, and interpret the coefficients. &lt;br/&gt;&lt;br/&gt;

Criticise, modify, compare, and evaluate the fit of the proposed models. 


---
## Structural equation modelling (SEM)

General framework that uses various models to test relationships among variables &lt;br/&gt;

Other terms: covariance structure analysis, covariance structure modelling, __causal modelling__&lt;br/&gt;

Sewell Wright - "mathematical tool for drawing __causal__ conclusions from a combination of of observational data and __theoretical assumptions__" 

Waves:
  1. Causal modelling through path models &lt;br/&gt;
  2. Latent structures - factor analysis &lt;br/&gt;
  3. Structural causal models &lt;br/&gt; &lt;br/&gt;&lt;br/&gt;
  
SEM is a general modelling framework that is composed of measurement model and the structural model. 

???
Judea Pearl - [The Causal Foundations of Structural Equation Modeling](https://ftp.cs.ucla.edu/pub/stat_ser/r370.pdf)

Measurement model focuses on the estimation of latent or composite variables &lt;br/&gt;
Structural model focuses on the estimation of relations between manifest  and/or latent variables in the model (path model) &lt;br/&gt;

Terminology:  &lt;br/&gt;

Manifest variables: observed/collected variables &lt;br/&gt; &lt;br/&gt; 
Latent variables: infered measures - hypothetical constructs  &lt;br/&gt;
 - Indicator variables: measures used to infer the latent concepts
&lt;br/&gt;
&lt;br/&gt; 

Endogenous variables: dependent outcomes &lt;br/&gt; &lt;br/&gt; 
Exogenous variables: predictors &lt;br/&gt; &lt;br/&gt; &lt;br/&gt; 

Focus on covariance structure instead of mean &lt;br/&gt; &lt;br/&gt; 
---
## Structural part of the model (path analysis)

Model that test relationship between set of variables, often arranged in some sort of structural form.
&lt;br/&gt;

A common focus of the path model is the estimation of mediation between X and Y.

.center[
&lt;img src="GeneralExample.png", width = "90%"&gt; &lt;br/&gt;
]

???
.center[
&lt;img src="graphical.png", width = "120%"&gt; &lt;br/&gt;
]
---

## First step: Specification of the model

Previous findings show that development of cognitive abilities in people depends on a range of factors in infancy and early childhood. General mental/cognitive abilities (e.g. reading or drawing), varied nutrition, physical exercises, and social engagement have shown to influence the level of cognitive abilities. Based on some of these studies, researchers postulate that social engagement is mediating factor between the behavioural factors and development of cognitive abilities. &lt;br/&gt; &lt;br/&gt;

.center[
&lt;img src="GeneralExample.png", width = "60%"&gt; &lt;br/&gt;
]
???
Representation of our hypothetical assumptions in the form of the structural equation model
---

## Can model be estimated? 

Total Number of the parameters that we can estimate: `\(\frac{variables*(variables+1)}{2}\)` &lt;br/&gt; &lt;br/&gt; &lt;br/&gt;


.center[
&lt;img src="GeneralExample.png", width = "60%"&gt; &lt;br/&gt;
]

---
## Number of observations




```r
Matrix&lt;-cov(Babies[,c('Nutrition','PhyExer','GMA','SocialBeh','CognitiveAb')])
Matrix[upper.tri(Matrix)]&lt;-NA
knitr::kable(Matrix, format = 'html')
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Nutrition &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; PhyExer &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; GMA &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SocialBeh &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CognitiveAb &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nutrition &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.6689837 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PhyExer &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -10.1006752 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2652.9074 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GMA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5641485 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -249.3049 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2478.2889 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; SocialBeh &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -11.6168733 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3417.8681 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -506.1066 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9988.898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CognitiveAb &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 210.6731970 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48916.6339 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1254.2100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 94358.621 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1125746 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## How many parameters are we estimating (path model)?

How many degrees of freedom do we have without the model? 

--
.center[
&lt;img src="ModelParameters.png", width = "60%"&gt; &lt;br/&gt;
]

Number of observations (total number of parameters) = 15&lt;br/&gt;
Empty model = variances and covariances &lt;br/&gt;
Degrees of freedom (df) __= 15 - 8 = 7__ &lt;br/&gt;

???
Most of the time (CFA model or other software):
Degree of freedom for null model = `\((\frac{variables*(variables+1)}{2}) - variables\)`


```r
Matrix&lt;-cov(Babies[,c('Nutrition','PhyExer','GMA','SocialBeh','CognitiveAb')])
Matrix[upper.tri(Matrix)]&lt;-NA
Matrix[lower.tri(Matrix)]&lt;-NA
knitr::kable(Matrix, format = 'html')
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Nutrition &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; PhyExer &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; GMA &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SocialBeh &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CognitiveAb &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nutrition &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.66898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PhyExer &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2652.907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GMA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2478.289 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; SocialBeh &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9988.898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CognitiveAb &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1125746 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
## How many parameters (our model)?

.center[
&lt;img src="ModelParameters.png", width = "60%"&gt; &lt;br/&gt;
]

Free parameters = variances + covariances + regression pathways = 14
---

## Second step: model identification

1. Under-indentified: more free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
2. Just-identified: equal number of free parameters and total possible parameters  &lt;br/&gt;&lt;br/&gt;
3. Over-identified: fewer free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
&lt;br/&gt;
Parameters can either be: free, fixed or constrained  &lt;br/&gt;

---

## Third step: estimation of the model

&lt;style type="text/css"&gt;
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
&lt;/style&gt;

&lt;style type="text/css"&gt;
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
&lt;/style&gt;


```r
modelAbility&lt;-'
SocialBeh~Nutrition+PhyExer+GMA
CognitiveAb~SocialBeh+Nutrition+GMA
'
```
--

```r
fit1&lt;-sem(modelAbility, data=Babies)
summary(fit1)
```

```
## lavaan 0.6.15 ended normally after 1 iteration
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer             1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh           9.579     0.469   20.428    0.000
##     Nutrition           7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
```

---

## Step four: model evaluation

Chi-square test: measure of how well model-implied covariance matrix fits data covariance &lt;br/&gt; &lt;br/&gt;

We would prefer not to reject the null hypothesis in this case &lt;br/&gt;

Assumptions: &lt;br/&gt;
Multivariate normality &lt;br/&gt;
N is sufficiently large (150+)&lt;br/&gt;
Parameters are not at boundary or invalid (e.g. variance of zero)&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

With the large samples it is sensitive to small misfits &lt;br/&gt;
Nonormality induces bias &lt;br/&gt; 
---

## Other fit indices

```r
summary(fit1, fit.measures=TRUE)
```

```
## lavaan 0.6.15 ended normally after 1 iteration
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Model Test Baseline Model:
## 
##   Test statistic                               438.108
##   Degrees of freedom                                 7
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    0.503
##   Tucker-Lewis Index (TLI)                      -2.479
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -1328.506
##   Loglikelihood unrestricted model (H1)      -1220.888
##                                                       
##   Akaike (AIC)                                2673.012
##   Bayesian (BIC)                              2693.853
##   Sample-size adjusted Bayesian (SABIC)       2668.587
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          1.464
##   90 Percent confidence interval - lower         1.303
##   90 Percent confidence interval - upper         1.632
##   P-value H_0: RMSEA &lt;= 0.050                    0.000
##   P-value H_0: RMSEA &gt;= 0.080                    1.000
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.080
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer             1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh           9.579     0.469   20.428    0.000
##     Nutrition           7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
```

---

## Other fit indices
.center[
&lt;img src="fitInd.png", width = "60%"&gt;
]

???
TLI: fit of .95 indicates that the fitted model improves the fit by 95% relative to the null mode, works OK with smaller sample sizes &lt;br/&gt; &lt;br/&gt;
CFI: Same as TLI, but not very sensitive to sample size &lt;br/&gt; &lt;br/&gt;
RMSEA: difference between the residuals of the sample covariance matrix and hypothesized model. If we have different scales it is hard to interpret, then we can check standardised root mean square residual (SRMR)&lt;br/&gt;&lt;br/&gt;
---

## Model modification

Add/take out theoretical pathways:


```r
modelAbility2&lt;-'
SocialBeh~Nutrition+PhyExer+GMA
CognitiveAb~SocialBeh+Nutrition+GMA+PhyExer
'
fit2&lt;-sem(modelAbility2, data=Babies)
summary(fit2, fit.measures=TRUE)
```

```
## lavaan 0.6.15 ended normally after 1 iteration
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         9
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 0.000
##   Degrees of freedom                                 0
## 
## Model Test Baseline Model:
## 
##   Test statistic                               438.108
##   Degrees of freedom                                 7
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.000
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -1220.888
##   Loglikelihood unrestricted model (H1)      -1220.888
##                                                       
##   Akaike (AIC)                                2459.776
##   Bayesian (BIC)                              2483.222
##   Sample-size adjusted Bayesian (SABIC)       2454.798
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent confidence interval - lower         0.000
##   90 Percent confidence interval - upper         0.000
##   P-value H_0: RMSEA &lt;= 0.050                       NA
##   P-value H_0: RMSEA &gt;= 0.080                       NA
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate   Std.Err  z-value  P(&gt;|z|)
##   SocialBeh ~                                          
##     Nutrition          0.030    1.105    0.027    0.978
##     PhyExer            1.281    0.146    8.796    0.000
##     GMA               -0.075    0.151   -0.500    0.617
##   CognitiveAb ~                                        
##     SocialBeh          5.701    0.213   26.781    0.000
##     Nutrition          8.548    2.352    3.634    0.000
##     GMA                2.814    0.321    8.764    0.000
##     PhyExer           11.390    0.413   27.577    0.000
## 
## Variances:
##                    Estimate   Std.Err  z-value  P(&gt;|z|)
##    .SocialBeh       5515.809  780.053    7.071    0.000
##    .CognitiveAb    24999.990 3535.532    7.071    0.000
```

---

## We can compare the models


```r
lavTestLRT(fit1,fit2)
```

```
## 
## Chi-Squared Difference Test
## 
##      Df    AIC    BIC  Chisq Chisq diff  RMSEA Df diff Pr(&gt;Chisq)    
## fit2  0 2459.8 2483.2   0.00                                         
## fit1  1 2673.0 2693.8 215.24     215.24 1.4637       1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```


---

## Or check modification indices


```r
modindices(fit1, sort=TRUE)
```

```
##            lhs op         rhs     mi    epc sepc.lv sepc.all sepc.nox
## 15   SocialBeh  ~ CognitiveAb 88.379 -0.228  -0.228   -2.420   -2.420
## 16 CognitiveAb  ~     PhyExer 88.379 11.390  11.390    0.553    0.011
## 22     PhyExer  ~ CognitiveAb 82.143  0.128   0.128    2.635    2.635
## 26         GMA  ~ CognitiveAb  1.601  0.025   0.025    0.529    0.529
## 18   Nutrition  ~ CognitiveAb  1.002  0.007   0.007    1.114    1.114
## 21     PhyExer  ~   SocialBeh  0.000  0.000   0.000    0.000    0.000
## 20   Nutrition  ~         GMA  0.000  0.000   0.000    0.000    0.000
## 19   Nutrition  ~     PhyExer  0.000  0.000   0.000    0.000    0.000
## 24     PhyExer  ~         GMA  0.000  0.000   0.000    0.000    0.000
## 28         GMA  ~     PhyExer  0.000  0.000   0.000    0.000    0.000
## 23     PhyExer  ~   Nutrition  0.000  0.000   0.000    0.000    0.000
## 25         GMA  ~   SocialBeh  0.000  0.000   0.000    0.000    0.000
## 17   Nutrition  ~   SocialBeh  0.000  0.000   0.000    0.000    0.000
```

---

## Direct and indirect

.center[
&lt;img src="simplified.png", width = "60%"&gt; 
]

Direct effect (c): subgroups/cases that differ by one unit on X, but are equal on M are estimated to differ by __c__ units on Y. &lt;br/&gt;

Indirect effect: &lt;br/&gt;
  a) X -&gt; M: cases that differ by one unit in X are estimated to differ by __a__ units on M &lt;br/&gt;
  b) M -&gt; Y: cases that differ by one unit in M, but are equal on X, are estimated to differ by __b__ units on Y &lt;br/&gt;&lt;br/&gt;
The indirect effect of X on Y through M is a product of __a__ and __b__. The two cases that differ by one unit on X are estimated to differ by __ab__ units on Y as a result of the effect of X on M which affects Y. 

---
## Direct and indirect


```r
modelAbilityPath&lt;-'
SocialBeh~Nutrition+a*PhyExer+GMA
CognitiveAb~b*SocialBeh+c*Nutrition+GMA

indirect := a*b
direct := c
total := indirect + direct
'
fitPath&lt;-sem(modelAbilityPath, data=Babies)
summary(fitPath)
```

```
## lavaan 0.6.15 ended normally after 1 iteration
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer    (a)      1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh  (b)      9.579     0.469   20.428    0.000
##     Nutrition  (c)      7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
## 
## Defined Parameters:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##     indirect           12.275     1.519    8.079    0.000
##     direct              7.019     6.899    1.017    0.309
##     total              19.294     7.074    2.727    0.006
```
???
Interaction between the predictors can be included similar to the linear regression model by using (:) sign.&lt;br/&gt; &lt;br/&gt;

modelAbilityInteraction&lt;-&lt;br/&gt;
SocialBeh~Nutrition+PhyExer+GMA+__PhyExer:GMA__&lt;br/&gt;
CognitiveAb~SocialBeh+Nutrition+GMA&lt;br/&gt;

---
## Prerequisites

Theory: Strong theoretical assumptions that could be used to draw causal assumptions that could be tested using the data and specification of the model &lt;br/&gt;&lt;br/&gt;

Data: large samples, N:p rule - 20:1, more data usually better estimates. &lt;br/&gt;
 - We are not that interested in significance: &lt;br/&gt;&lt;br/&gt;
  a) Overall behaviour of the model more interesting&lt;br/&gt;&lt;br/&gt;
  b) More data higher probability of significant results (weak effects)&lt;br/&gt;&lt;br/&gt;
  c) Latent models are estimated by anchoring on indicator variables, different estimation can result in different patterns&lt;br/&gt;&lt;br/&gt;

---
## Problems with SEM and alternatives

1. Variables derived from the normal distribution &lt;br/&gt;
2. Observations independent &lt;br/&gt;
3. Large sample size &lt;br/&gt;

---
## PiecewiseSEM
.center[
&lt;img src="PiecewiseSEM.png", width = "60%"&gt; 
]

Variables are causally dependent if there is an arrow between them &lt;br/&gt;
There are causally independent if there are no arrows between them &lt;br/&gt;
&lt;br/&gt;
X1 is causally independent from Y2 _conditional_ on Y1

PiecewiseSEM performs a test of directional separation (d-sep) and asks whether causally independent paths are significant when controlling for variables on which causal process is conditional.

???
https://jonlefcheck.net/2014/07/06/piecewise-structural-equation-modeling-in-ecological-research/

---

## PiecewiseSEM 


```r
#install.packages('piecewiseSEM)
require(piecewiseSEM)
model1&lt;-psem(lm(SocialBeh~Nutrition+PhyExer+GMA, data=Babies),
             lm(CognitiveAb~SocialBeh+Nutrition+GMA, data=Babies))
summary(model1, .progressBar=FALSE)
```

```
## 
## Structural Equation Model of model1 
## 
## Call:
##   SocialBeh ~ Nutrition + PhyExer + GMA
##   CognitiveAb ~ SocialBeh + Nutrition + GMA
## 
##     AIC      BIC
##  229.364   255.416
## 
## ---
## Tests of directed separation:
## 
##                Independ.Claim Test.Type DF Crit.Value P.Value    
##   CognitiveAb ~ PhyExer + ...      coef 95    26.8792       0 ***
## 
## Global goodness-of-fit:
## 
##   Fisher's C = 209.364 with P-value = 0 and on 2 degrees of freedom
## 
## ---
## Coefficients:
## 
##      Response Predictor Estimate Std.Error DF Crit.Value P.Value Std.Estimate
##     SocialBeh Nutrition   0.0300    1.1278 96     0.0266  0.9789       0.0020
##     SocialBeh   PhyExer   1.2814    0.1487 96     8.6187  0.0000       0.6604
##     SocialBeh       GMA  -0.0753    0.1538 96    -0.4899  0.6253      -0.0375
##   CognitiveAb SocialBeh   9.5792    0.4786 96    20.0156  0.0000       0.9023
##   CognitiveAb Nutrition   7.0193    7.0413 96     0.9969  0.3213       0.0447
##   CognitiveAb       GMA   2.4607    0.9607 96     2.5614  0.0120       0.1155
##      
##      
##   ***
##      
##   ***
##      
##     *
## 
##   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05
## 
## ---
## Individual R-squared:
## 
##      Response method R.squared
##     SocialBeh   none      0.44
##   CognitiveAb   none      0.81
```

---

class: inverse, middle, center
# Practical aspect
---

## Getting the data


```r
NBAPath&lt;-read.table('NBApath.txt', sep='\t', header=T)
```
---

## What is in the data? 


```r
summary(NBAPath)
```

```
##      TEAM                PCT            Player              Pos           
##  Length:3810        Min.   :0.1061   Length:3810        Length:3810       
##  Class :character   1st Qu.:0.3780   Class :character   Class :character  
##  Mode  :character   Median :0.5000   Mode  :character   Mode  :character  
##                     Mean   :0.4905                                        
##                     3rd Qu.:0.6098                                        
##                     Max.   :0.8902                                        
##       Age              GP             PER        
##  Min.   :18.00   Min.   : 1.00   Min.   :-13.10  
##  1st Qu.:23.00   1st Qu.:34.00   1st Qu.: 10.00  
##  Median :25.00   Median :61.00   Median : 12.80  
##  Mean   :26.05   Mean   :53.73   Mean   : 12.75  
##  3rd Qu.:29.00   3rd Qu.:77.00   3rd Qu.: 15.80  
##  Max.   :43.00   Max.   :82.00   Max.   : 35.20
```

---

## Correlation matrix


```r
cor(NBAPath[,c(2,5:7)])
```

```
##            PCT        Age         GP        PER
## PCT 1.00000000 0.14304325 0.08849459 0.07720633
## Age 0.14304325 1.00000000 0.05170204 0.03598025
## GP  0.08849459 0.05170204 1.00000000 0.45360129
## PER 0.07720633 0.03598025 0.45360129 1.00000000
```

---

## Univariate plots


```r
par(mfrow=c(1,2), bty='n',mar = c(5, 4, .1, .1), cex=1.1, pch=16)
plot(density(NBAPath$PER), main='')
plot(density(NBAPath$PCT), main='')
```

&lt;img src="Week5_files/figure-html/unnamed-chunk-17-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## Bivariate plots


```r
par(mfrow=c(1,2), bty='n',mar = c(5, 4, .1, .1), cex=1.1, pch=16)
plot(NBAPath$Age, NBAPath$PER)
plot(NBAPath$GP, NBAPath$PER)
```

&lt;img src="Week5_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## Specification of the model 

&lt;img src="image8.png" width="70%" style="display: block; margin: auto;" /&gt;


---

## Identification of the model

What is the total number of parameters that we can estimate? &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
What is the number of free parameters that our model is estimating? &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

Is our model: &lt;br/&gt;
a) under-identified &lt;br/&gt;
b) just-identified &lt;br/&gt;
c) over-identified&lt;br/&gt;

Three path coefficients  &lt;br/&gt;
Two error variances  &lt;br/&gt;
One independent variable variance &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;



Just identified model&lt;br/&gt;

???
Total number of parameters that we can estimate: 3*4/2 = 6&lt;br/&gt;
Number of free parameters: 1 variance, 2 errors, 3 regression pathways = 6 &lt;br/&gt;
Just-identified model
---

## Estimating the model


```r
NBAmod1&lt;-'
GP~b*Age
PER~a*Age+c*GP

dir := a
ind := b*c
tot := dir + ind
'
NBAfit1&lt;-sem(NBAmod1, data=NBAPath)
summary(NBAfit1)
```

```
## lavaan 0.6.15 ended normally after 10 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         5
## 
##   Number of observations                          3810
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 0.000
##   Degrees of freedom                                 0
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   GP ~                                                
##     Age        (b)    0.315    0.098    3.196    0.001
##   PER ~                                               
##     Age        (a)    0.016    0.018    0.869    0.385
##     GP         (c)    0.093    0.003   31.333    0.000
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .GP              645.883   14.798   43.646    0.000
##    .PER              21.834    0.500   43.646    0.000
## 
## Defined Parameters:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##     dir               0.016    0.018    0.869    0.385
##     ind               0.029    0.009    3.179    0.001
##     tot               0.045    0.020    2.222    0.026
```

---

## Explained variance - R2

When just identified model, we cannot use global indices of model fit &lt;br/&gt;
We need to use standard measures &lt;br/&gt;


```r
inspect(NBAfit1, 'r2')
```

```
##    GP   PER 
## 0.003 0.206
```

```r
-2*logLik(NBAfit1)
```

```
## 'log Lik.' 58025.67 (df=5)
```

```r
AIC(NBAfit1)
```

```
## [1] 58035.67
```

---

## Respecification of the model 

&lt;img src="image9.png" width="70%" style="display: block; margin: auto;" /&gt;

???

```r
NBAmod2&lt;-'
GP~b*Age
PER~c*GP

ind := b*c
'
NBAfit2&lt;-sem(NBAmod2, data=NBAPath)
summary(NBAfit2, fit.measures=T)
```

```
## lavaan 0.6.15 ended normally after 10 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         4
## 
##   Number of observations                          3810
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 0.755
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.385
## 
## Model Test Baseline Model:
## 
##   Test statistic                               888.633
##   Degrees of freedom                                 3
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.001
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)             -29013.211
##   Loglikelihood unrestricted model (H1)     -29012.833
##                                                       
##   Akaike (AIC)                               58034.422
##   Bayesian (BIC)                             58059.403
##   Sample-size adjusted Bayesian (SABIC)      58046.693
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent confidence interval - lower         0.000
##   90 Percent confidence interval - upper         0.041
##   P-value H_0: RMSEA &lt;= 0.050                    0.987
##   P-value H_0: RMSEA &gt;= 0.080                    0.000
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.005
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   GP ~                                                
##     Age        (b)    0.315    0.098    3.196    0.001
##   PER ~                                               
##     GP         (c)    0.093    0.003   31.417    0.000
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .GP              645.883   14.798   43.646    0.000
##    .PER              21.838    0.500   43.646    0.000
## 
## Defined Parameters:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##     ind               0.029    0.009    3.179    0.001
```

---

## Model comparison


```r
#install.packages('semTools')
require(semTools)
diff&lt;-compareFit(NBAfit1, NBAfit2)
summary(diff)
```

```
## ################### Nested Model Comparison #########################
## 
## Chi-Squared Difference Test
## 
##         Df   AIC   BIC Chisq Chisq diff RMSEA Df diff Pr(&gt;Chisq)
## NBAfit1  0 58036 58067 0.000                                    
## NBAfit2  1 58034 58059 0.755      0.755     0       1     0.3849
## 
## ####################### Model Fit Indices ###########################
##         chisq df pvalue rmsea    cfi    tli  srmr        aic        bic
## NBAfit1 .000†        NA .000† 1.000† 1.000  .000† 58035.667  58066.894 
## NBAfit2 .755   1   .385 .000† 1.000† 1.001† .005  58034.422† 58059.403†
## 
## ################## Differences in Fit Indices #######################
##                   df rmsea cfi   tli  srmr    aic   bic
## NBAfit2 - NBAfit1  1     0   0 0.001 0.005 -1.245 -7.49
```

---

## Respecification of the model 

&lt;img src="image10.png" width="70%" style="display: block; margin: auto;" /&gt;

???


```r
NBAmod3&lt;-'
GP~b*Age
PER~a*Age+c*GP
PCT~d*PER
ind1 := b*c*d
ind2 := a*d
tot := ind1 + ind2
'
NBAfit3&lt;-sem(NBAmod3, data=NBAPath)
summary(NBAfit3, fit.measures=T)
```

```
## lavaan 0.6.15 ended normally after 20 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         7
## 
##   Number of observations                          3810
## 
## Model Test User Model:
##                                                       
##   Test statistic                                87.884
##   Degrees of freedom                                 2
##   P-value (Chi-square)                           0.000
## 
## Model Test Baseline Model:
## 
##   Test statistic                               999.296
##   Degrees of freedom                                 6
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    0.914
##   Tucker-Lewis Index (TLI)                       0.741
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)             -27272.876
##   Loglikelihood unrestricted model (H1)     -27228.934
##                                                       
##   Akaike (AIC)                               54559.752
##   Bayesian (BIC)                             54603.469
##   Sample-size adjusted Bayesian (SABIC)      54581.227
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.106
##   90 Percent confidence interval - lower         0.088
##   90 Percent confidence interval - upper         0.126
##   P-value H_0: RMSEA &lt;= 0.050                    0.000
##   P-value H_0: RMSEA &gt;= 0.080                    0.990
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.047
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   GP ~                                                
##     Age        (b)    0.315    0.098    3.196    0.001
##   PER ~                                               
##     Age        (a)    0.016    0.018    0.869    0.385
##     GP         (c)    0.093    0.003   31.333    0.000
##   PCT ~                                               
##     PER        (d)    0.002    0.000    4.780    0.000
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .GP              645.883   14.798   43.646    0.000
##    .PER              21.834    0.500   43.646    0.000
##    .PCT               0.023    0.001   43.646    0.000
## 
## Defined Parameters:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##     ind1              0.000    0.000    2.647    0.008
##     ind2              0.000    0.000    0.855    0.393
##     tot               0.000    0.000    2.015    0.044
```

---

## Parameter estimates


```r
parameterestimates(NBAfit3, boot.ci.type ='bca.simple', standardized = T)
```

```
##     lhs op       rhs label     est     se      z pvalue ci.lower ci.upper
## 1    GP  ~       Age     b   0.315  0.098  3.196  0.001    0.122    0.507
## 2   PER  ~       Age     a   0.016  0.018  0.869  0.385   -0.020    0.051
## 3   PER  ~        GP     c   0.093  0.003 31.333  0.000    0.087    0.099
## 4   PCT  ~       PER     d   0.002  0.000  4.780  0.000    0.001    0.003
## 5    GP ~~        GP       645.883 14.798 43.646  0.000  616.879  674.887
## 6   PER ~~       PER        21.834  0.500 43.646  0.000   20.853   22.814
## 7   PCT ~~       PCT         0.023  0.001 43.646  0.000    0.022    0.025
## 8   Age ~~       Age        17.498  0.000     NA     NA   17.498   17.498
## 9  ind1 :=     b*c*d  ind1   0.000  0.000  2.647  0.008    0.000    0.000
## 10 ind2 :=       a*d  ind2   0.000  0.000  0.855  0.393    0.000    0.000
## 11  tot := ind1+ind2   tot   0.000  0.000  2.015  0.044    0.000    0.000
##     std.lv std.all std.nox
## 1    0.315   0.052   0.012
## 2    0.016   0.013   0.003
## 3    0.093   0.453   0.453
## 4    0.002   0.077   0.077
## 5  645.883   0.997   0.997
## 6   21.834   0.794   0.794
## 7    0.023   0.994   0.994
## 8   17.498   1.000  17.498
## 9    0.000   0.002   0.000
## 10   0.000   0.001   0.000
## 11   0.000   0.003   0.001
```

---

## Bootstrapping our model


```r
#install.packages('bootstrap')
require(bootstrap)
boot&lt;-bootstrapLavaan(NBAfit3, R=1000)
summary(boot)
```

```
##        b                a                   c                 d            
##  Min.   :0.0123   Min.   :-0.042472   Min.   :0.07663   Min.   :0.0004267  
##  1st Qu.:0.2538   1st Qu.: 0.004103   1st Qu.:0.09040   1st Qu.:0.0019577  
##  Median :0.3171   Median : 0.016137   Median :0.09339   Median :0.0022663  
##  Mean   :0.3188   Mean   : 0.015824   Mean   :0.09319   Mean   :0.0022812  
##  3rd Qu.:0.3823   3rd Qu.: 0.027170   3rd Qu.:0.09579   3rd Qu.:0.0025987  
##  Max.   :0.6498   Max.   : 0.074937   Max.   :0.10785   Max.   :0.0039386  
##      GP~~GP         PER~~PER        PCT~~PCT      
##  Min.   :614.3   Min.   :19.41   Min.   :0.02215  
##  1st Qu.:637.7   1st Qu.:21.24   1st Qu.:0.02320  
##  Median :644.2   Median :21.81   Median :0.02349  
##  Mean   :645.2   Mean   :21.82   Mean   :0.02349  
##  3rd Qu.:651.9   3rd Qu.:22.37   3rd Qu.:0.02377  
##  Max.   :684.7   Max.   :25.02   Max.   :0.02488
```

---

## Model building

.center[
&lt;img src="Loop.png", width = "50%"&gt;
]

---
## Important aspects: theory

- Difference between moderation, mediation and conditional process analysis &lt;br/&gt;
- Exogenous and endogenous variables &lt;br/&gt;
- Interpretation of the predictors &lt;br/&gt;
- Calculation of free parameters and total parameters &lt;br/&gt;
- Model identification: three-types of identifications &lt;br/&gt;
- Overall fit of the model 

---

## Important aspects: practice

- Building path model: both continous and categorical exogenous variables &lt;br/&gt;
- Calculation of the direct and indirect pathways for predictors of interest &lt;br/&gt;
- Adding an interaction to path model &lt;br/&gt;
- Interpretation of the coefficients &lt;br/&gt;
- Getting fit indices of the model &lt;br/&gt;

---
## Literature

Chapters 1 to 5 of Principles and Practice of Structural Equation Modeling by Rex B. Kline &lt;br/&gt;&lt;br/&gt; 

Introduction to Mediation, Moderation, and Conditional Process Analysis: A Regression-Based Approach by Andrew F. Hayes &lt;br/&gt;&lt;br/&gt; 

Latent Variable Modeling Using R: A Step-by-Step Guide by A. Alexander Beaujean &lt;br/&gt;&lt;br/&gt;

---
## Exercises for the next week

1. Fill the reflection and feedback form by Monday: https://forms.gle/ZNpui99GyYZbE4UZ7 &lt;br/&gt;&lt;br/&gt;
2. Go over practical aspects of the lecture; Try building path models in R &lt;br/&gt;&lt;br/&gt;
3. Think about what theory in psychology could you test using path modelling (regardless of you having the data). Think about how easy/difficult would be to defend the causal claims&lt;br/&gt;&lt;br/&gt;
---

# Thank you for your attention
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
